{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load i18n %}
{% block title %}{% blocktrans with query=query %}Search Results for "{{ query }}"{% endblocktrans %}{% endblock %}{% block head_extra %}
<meta name="robots" content="noindex, nofollow">
<meta property="og:title" content="{% block og_title %}{% trans 'Softaka – Safe, Fast & Verified Software Downloads' %}{% endblock %}" />
<meta property="og:description" content="{% block og_description %}{% trans 'Download free software, apps, games, and utilities for Windows. Secure, fast, and easy downloads for all your needs.' %}{% endblock %}" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{ request.build_absolute_uri }}" />
<meta property="og:image" content="{% block og_image %}{% static 'software/placeholder.png' %}{% endblock %}" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{% block twitter_title %}{% trans 'Softaka – Safe, Fast & Verified Software Downloads' %}{% endblock %}" />
<meta name="twitter:description" content="{% block twitter_description %}{% trans 'Download free software, apps, games, and utilities for Windows. Secure, fast, and easy downloads for all your needs.' %}{% endblock %}" />
<meta name="twitter:image" content="{% block twitter_image %}{% static 'software/placeholder.png' %}{% endblock %}" />
<link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}{% url 'software:search-results' %}">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "CollectionPage",
      "mainContentOfPage": {
        "@type": "WebPageElement",
        "name": "{% trans "Search results for" %}: {{ query }}"
      }
    },
    {
      "@type": "BreadcrumbList",
      "inLanguage": "{{ LANGUAGE_CODE }}",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "{% trans 'Home' %}",
          "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'software:index' %}"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "{% trans "Search Results" %}",
          "item": "{{ request.build_absolute_uri }}"
        }
      ]
    }{% for software in search_results %},
    {
      "@type": "SoftwareApplication",
      "@id": "{{ request.scheme }}://{{ request.get_host }}{{ software.get_absolute_url }}#software",
      "name": "{{ software.name|escapejs }}",
      "operatingSystem": "{{ software.operating_system|default:'Windows, macOS, Linux' }}",
      "applicationCategory": "{{ software.category.name|default:'Utilities' }}",
      "url": "{{ request.scheme }}://{{ request.get_host }}{{ software.get_absolute_url }}",
      "image": "{{ software.image.url }}",
      "description": "{{ software.short_description|default:software.description|striptags|truncatechars:160|escapejs }}",
      "inLanguage": "{{ LANGUAGE_CODE }}",
      "softwareVersion": "{% if software.versions.all.0 %}{{ software.versions.all.0.version_number }}{% else %}1.0{% endif %}",
      "downloadUrl": "{{ request.scheme }}://{{ request.get_host }}{% if software.versions.all.0 %}{% url 'software:file-download' %}?id={{ software.versions.all.0.pk }}{% endif %}",
      "fileSize": "{{ software.file_size|default:'1 GB' }}",
      "offers": {
        "@type": "Offer",
        "price": "0.00",
        "priceCurrency": "USD",
        "availability": "https://schema.org/InStock",
        "url": "{{ request.scheme }}://{{ request.get_host }}{{ software.get_absolute_url }}"
      }{% if software.total_ratings > 0 %},
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "{{ software.average_rating|stringformat:'0.1f' }}",
        "reviewCount": "{{ software.total_ratings }}"
      }{% endif %},
      "publisher": {
        "@type": "Organization",
        "name": "Softaka",
        "url": "https://softaka.com/",
        "logo": {
          "@type": "ImageObject",
          "url": "https://softaka.com{% static 'images/logo.png' %}"
        }
      }
    }{% endfor %}
  ]
}
</script>
{% endblock %}
{% block main_content_area %}
    <div class="col-md-12"> 
        {% block content %}
            <h2 class="mb-4">{% blocktrans with query=request.GET.q %}Search Results for "{{ query }}"{% endblocktrans %}</h2>

            {% if software_list %}
                <div class="row">
                    {% for software in software_list %}
                        <div class="col-md-4 col-sm-6 mb-4"> 
                            <div class="card h-100 shadow-sm filecr-card">
                                <div class="card-body d-flex flex-column"> 
                                    <div class="d-flex align-items-center mb-3">
                                        {% if software.image_thumbnail %}
                                            <img src="{{ software.image_thumbnail.url }}" class="software-card-img-thumbnail me-3" alt="{{ software.name }}" width="56" height="56">
                                        {% elif software.image %}
                                            <img src="{{ software.image.url }}" class="software-card-img-thumbnail me-3" alt="{{ software.name }}" width="56" height="56">
                                        {% else %}
                                            <img src="{% static 'software/placeholder.png' %}" class="software-card-img-thumbnail me-3" alt="{% trans 'No image' %}" width="56" height="56">
                                        {% endif %}
                                        <div class="flex-grow-1">
                                            <h5 class="card-title mb-1">
                                                <a href="{% url 'software:software-detail' category_slug=software.category.slug slug=software.slug %}" class="text-decoration-none text-dark fw-bold">{{ software.name }}</a>
                                            </h5>
                                            {% if software.short_description %}
                                                <p class="card-subtitle text-muted small">{{ software.short_description }}</p>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-between text-muted small mb-2">
                                        <div>
                                            {% trans "Category" %}: <a href="{% url 'software:category-software-list' slug=software.category.slug %}" class="text-decoration-none">{{ software.category.name }}</a>
                                        </div>
                                        {% if software.operating_system %}
                                            <div class="text-capitalize">{{ software.operating_system }}</div>
                                        {% endif %}
                                    </div>

                                    <p class="card-text text-muted small mb-auto">
                                        {{ software.homepage_description|default:software.description|truncatewords:15|safe }}
                                    </p>

                                    <div class="mt-3 pt-3 border-top d-flex justify-content-between align-items-center">
                                        <div class="d-flex flex-column text-center me-3">
                                            {% if software.download_count is not None %}
                                                <span class="fw-bold fs-6 text-primary">{{ software.download_count|intcomma }}</span>
                                                <small class="text-muted">{% trans "Reputation" %}</small>
                                            {% endif %}
                                        </div>
                                        <div class="d-flex flex-column text-center flex-grow-1 me-3">
                                            {% if software.file_size %}
                                                <span class="fw-bold fs-6 text-secondary">{{ software.file_size }}</span>
                                                <small class="text-muted">{% trans "Size" %}</small>
                                            {% endif %}
                                        </div>
                                        <div class="ms-auto">
                                            <a href="{% url 'software:software-detail' category_slug=software.category.slug slug=software.slug %}" class="btn btn-sm btn-outline-primary">{% trans "View Details" %}</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <p>{% trans "No software found matching your search query." %}</p>
                    {% endfor %}
                </div>

                {% if is_paginated %}
                <div class="pagination d-flex justify-content-center my-4">
                    <nav aria-label="{% trans 'Page navigation' %}">
                        <ul class="pagination">
                            {% if page_obj.has_previous %}
                                <li class="page-item"><a class="page-link" href="?q={{ request.GET.q }}&page={{ page_obj.previous_page_number }}">{% trans "Previous" %}</a></li>
                            {% endif %}
                            <li class="page-item active" aria-current="page">
                                <span class="page-link">{% blocktrans with current=page_obj.number total=page_obj.paginator.num_pages %}Page {{ current }} of {{ total }}{% endblocktrans %}</span>
                            </li>
                            {% if page_obj.has_next %}
                                <li class="page-item"><a class="page-link" href="?q={{ request.GET.q }}&page={{ page_obj.next_page_number }}">{% trans "Next" %}</a></li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                {% endif %}

            {% else %}
                <p>{% trans "No software found matching your search query." %}</p>
            {% endif %}
        {% endblock content %}
    </div>
{% endblock main_content_area %}
